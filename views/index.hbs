<div class="index-container">
  <div class="container l-panel w-25 p-5 px-10 rounded-3 m-auto">
    <div class="d-flex align-items-center justify-content-between">
      <div>
        <h4 class="fw-light mb-0">Hello,</h4>
        <h2>Lucas!</h2>
      </div>
      <img
        src="https://via.placeholder.com/150"
        class="rounded-circle border border-3 border-primary avatar"
        alt="Avatar"
        width="100"
        height="100"
      />
    </div>
    <hr class="my-4" />
    
    <!-- Initial View -->
    <div id="initial-view">
      <h4 class="fw-light mb-3">How are you<br />feeling today?</h4>
      <form action="">
        <input
          type="search"
          class="form-control"
          id="search-input"
          placeholder="Search..."
          aria-label="Search"
        />
      </form>
    
      <div id="mood-buttons">
        {{#each dataset}}
          <button
            class="badge rounded-pill py-2 px-3 mb-2"
            data-bs-toggle="tooltip"
            data-bs-placement="top"
            title="{{this.tooltip}}"
            style="background-color: 
              {{#ifCond this.type '==' 'Positive'}}#00CCDD{{/ifCond}}
              {{#ifCond this.type '==' 'Neutral'}}#4F75FF{{/ifCond}}
              {{#ifCond this.type '==' 'Negative'}}#6439FF{{/ifCond}}"
            data-mood="{{this.mood}}"
            this-type="{{this.type}}"
          >
            {{this.mood}}
          </button>
        {{/each}}
      </div>
    </div>
    
    <!-- Selected Mood View -->
    <div id="selected-mood-view" style="display: none;">
      <h4 id="selected-mood-text"></h4>
      <form action="">
        <textarea class="form-control mt-4" name="note" id="note" placeholder="Add comment" rows="8" style="resize: none;"></textarea>
        <label class="mt-4" for="upload-image">Add image</label>
        <input type="file" class="form-control-file" id="upload-image" accept="image/*" style="width: 100%;">
        <button id="back-button" class="btn btn-outline-secondary mt-4">Back</button>
        <button id="submit-button" class="btn btn-secondary mt-4">Submit</button>
      </form>
    </div>
  </div>
  <div class="container r-panel w-75 p-5 px-10 rounded-3 m-auto"></div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    var tooltipTriggerList = [].slice.call(
      document.querySelectorAll('[data-bs-toggle="tooltip"]')
    );
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
      return new bootstrap.Tooltip(tooltipTriggerEl);
    });

    const searchInput = document.getElementById("search-input");
    const moodButtonsContainer = document.getElementById("mood-buttons");
    const initialView = document.getElementById("initial-view");
    const selectedMoodView = document.getElementById("selected-mood-view");
    const selectedMoodText = document.getElementById("selected-mood-text");
    const backButton = document.getElementById("back-button");

    // Handle search functionality
    searchInput.addEventListener("input", function (event) {
      const query = event.target.value.toLowerCase();
      const buttons = moodButtonsContainer.querySelectorAll("button");

      buttons.forEach(function (button) {
        const moodText = button.textContent.toLowerCase();
        button.style.display = moodText.includes(query) ? "inline-block" : "none";
      });
    });

    // Handle mood selection
    moodButtonsContainer.addEventListener("click", function (event) {
      if (event.target.tagName === "BUTTON") {
        const selectedMood = event.target.getAttribute("data-mood");
        const selectedType = event.target.getAttribute("this-type");
        let bgColor = "";

        if (selectedType === "Positive") bgColor = "#00CCDD";
        else if (selectedType === "Neutral") bgColor = "#4F75FF";
        else if (selectedType === "Negative") bgColor = "#6439FF";

        initialView.style.display = "none";
        selectedMoodView.style.display = "block";
        selectedMoodText.innerHTML = `
          You are feeling</h4>
          <span class="d-block mb-0 fw-bold" style="color: ${bgColor}; font-size: 52px">${selectedMood}</span>
          <h4>today.
        `;
      }
    });

    // Handle back button
    backButton.addEventListener("click", function (event) {
      event.preventDefault();
      initialView.style.display = "block";
      selectedMoodView.style.display = "none";
    });

    // Handle file input
    const uploadImageInput = document.getElementById("upload-image");
    const fileNameDisplay = document.getElementById("file-name");

    uploadImageInput.addEventListener("change", function () {
      const file = this.files[0];
      if (file) {
        const fileName = file.name;
        const shortName =
          fileName.length > 13
            ? fileName.substring(0, 10) + "..." + fileName.substring(fileName.lastIndexOf("."))
            : fileName;

        file.name.textContent = `Selected file: ${shortName}`;
      } else {
        file.name.textContent = "";
      }
    });
  });
</script>
